# Section1. Next.js란?

> 페이지 라우터 + 빌트인 최적화 기능 + 다이나믹 HTML 스트리밍

- Next = React 전용의 웹 개발 프레임워크
- React = UI 개발을 위한 자바스크립트 라이브러리

### Framework vs Library

기능 구현의 주도권이 누구에게 있는가에 따라 구분

- 프레임워크 - 주도권을 프레임워크가 가짐, 자유도가 낮음
- 라이브러리 - 주도권을 개발자가 가짐, 자유도가 높음 => 기본 기능 외 제공 x

### Next의 사전 렌더링 (Pre Rendering)

브라우저의 요청에 사전에 렌더링이 완료된 HTML을 응답하는 렌더링 방식이다. -> CSR의 단점을 해결

서버에서 모든 리액트 컴포넌트를 다 실행해서, 이 컴포넌트들을 HTML 페이지로 미리 변환한다. 즉, 사전에 렌더링이 완료된 HTML을 보내준다 = 사전 렌더링

또한, 서버는 리액트 앱을 번들링해서 브라우저에게 보내주는데 사전 렌더링된 HTML과 연결해준다. (수화 과정) 따라서, 상호작용이 가능한 페이지가 완성된다. (TTI 지표)

그렇다면, 페이지 이동은 어떻게 처리될까? CSR 방식으로.

### React의 렌더링 과정 (CSR)

웹 브라우저는 index.html 을 브라우저에게 보내주고,일단 이 화면을 렌더링시킨다. 자바스크립트 코드를 HTML 페이지로 렌더링

- 장점: 초기 접속 이후의 페이지 이동이 빠름
- 딘점: 초기 접속 속도, 성능에 중요한 지표 중 하나인 FCP가 느리다

<br/>

# Section2. Page Router

Pages 폴더의 구조를 기반으로 페이지 라우팅을 제공한다.

### \_app.tsx

모든 페이지 역할을 하는 컴포넌트들의 부모 컴포넌트

```tsx
export default function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}
```

- Component
- pageProps: 페이지의 프롭스들을 모두 객체로 보관

### \_document.tsx

index.html 과 비슷한 역할

```tsx
export default function Document() {
  return (
    <Html lang="en">
      <Head />
      <body>
        <Main />
        <NextScript />
      </body>
    </Html>
  );
}
```

### 페이지 라우팅 설정하기

폴더명 기반 or 파일명 기반

- book 폴더 > [[...id]].tsx // 동적 파라미터, optional catch all segment

- book 폴더 > index.tsx

```tsx
export default function Page() {
  const router = useRouter();

  const { id } = router.query; // 동적 파라미터

  const { q } = router.query; // 쿼리 스트링

  return <h1>Book {id}</h1>;
}
```

### 네비게이팅

```tsx
<Link href={`/book/${id}`} className={style.container}></Link>
```

### 프리페칭

페이지를 사전에 불러온다 -> 엄청 빠른 속도로 페이지 이동을 할 수 있다

Next는 모든 리액트 컴포넌트들을 페이지별로 분리해서 저장을 미리 해둔다.

JS 번들은 현재 페이지에 필요한 파일만 전달한다.

```tsx
export default function App({ Component, pageProps }: AppProps) {
  const router = useRouter();

  const onClickButton = () => {
    router.push('/test');
  };

  useEffect(() => {
    router.prefetch('/test');
  }, []);

  return (
    <>
      <header>
        <Link href={'/'}>index</Link>
        &nbsp;
        <Link href={'/search'} prefetch={false}>
          search
        </Link>
        &nbsp;
        <Link href={'/book/1'}>book/1</Link>
        <div>
          <button onClick={onClickButton}>/test 페이지로 이동</button>
        </div>
      </header>
      <Component {...pageProps} />
    </>
  );
}
```

### API Routes

Next에서 API를 구축할 수 있게 해주는 기능

```ts
// time.ts
import { NextApiRequest, NextApiResponse } from 'next';

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  const date = new Date();
  res.json({ time: date.toLocaleString() });
}
```

http://localhost:3000/api/time

### 스타일링

### 글로벌/페이지별 레이아웃

#### getLayout

```tsx
export default function Page() {
  const router = useRouter();

  const { q } = router.query;

  return <h1>Search {q}</h1>;
}

Page.getLayout = (page: ReactNode) => {
  return <SearchableLayout>{page}</SearchableLayout>;
};
```

```tsx
type NextPageWithLayout = NextPage & {
  getLayout?: (page: ReactNode) => ReactNode;
};

export default function App({
  Component,
  pageProps,
}: AppProps & { Component: NextPageWithLayout }) {
  const getLayout = Component.getLayout ?? ((page: ReactNode) => page);

  return <GlobalLayout>{getLayout(<Component {...pageProps} />)}</GlobalLayout>;
}
```
